/** * @content 用户登录、注册js * @author gaorunqiao *  */var imgAreaObj = ''; //图片选区对象function AddRegUser(){        $.ajax({            type: "POST",            dataType: "html",            url:  "/"+base_script+"/ureg",            data: $('#uregPopForm').serialize(),            success: function (result) {            	jQuery('.popWindow').remove();            	jQuery('.divLayer').remove();            	location.reload();            },            error: function(data) {                return false;             }        });}/**---------------register vilidate------------------- */ function regCheck(type){	//var email = jQuery.trim(jQuery('#email').val());	//var username = jQuery.trim(jQuery('#username').val());	var pwd = jQuery.trim(jQuery('#pwd').val());	var repwd = jQuery.trim(jQuery('#repwd').val());	var chkval= jQuery('#ourtreaty').attr("checked");	//showMessageNote(checkEmail())			//手机检测	if(checkMobilePhone()==false) return false;	//验证码	if(checkAuthCode()==false) return false;	//手机验证码检测	if(checkPhoneAuthCode()==false) return false;			if(pwd==''){		showMessageNote('密码不能为空。');		return false;	}else if(pwd.length<6||pwd.length>20){		showMessageNote('输入密码需在6位到20位之间。');		return false;	}		if(repwd==''){		showMessageNote('密码确认不能为空。');		return false;	}else if(pwd!=repwd){		showMessageNote('密码不一致。');		return false;	}	if(type==undefined || type=="passive"){//当type未定义需要检测验证码		//验证码检测		if(checkAuthCode()==false) return false;	}	//检测注册条款是否勾选	if(!chkval || !chkval=="undefine" || chkval==""){		showMessageNote('请阅读注册条款并向切格瓦拉保证一定遵守。');		return false;	}	if(type=="passive") AddRegUser();	else{		document.getElementById("uregForm").submit();		return true;	}			}//验证码正确隐藏显示手机验证码function HideAuthCode(obj){	//showMessageNote(checkAuthCode());	if(obj.value.length == 4){		if(checkAuthCode() == true){			jQuery("#authcodeDiv").hide();			jQuery("#PhoneCodeDiv").show();			jQuery("#mobile_button").click();		}	}}//显示验证码function ShowAuthCode(){		jQuery("#authcodeDiv").show();		jQuery("#PhoneCodeDiv").hide();		jQuery("#authcode").val('');		jQuery("#authcode").focus();		getnewimg();}//检测验证码是否正确function checkAuthCode(){	jQuery.ajaxSetup({async:false});	var checkFlag = false;	var authCode = jQuery.trim(jQuery("#authcode").val() );	if(authCode==''){		//showMessageNote("请输入图形验证码！")		return false;	}	jQuery.getJSON("/"+base_script+"/ureg/",encodeURI("act=chkCode&code="+authCode),function(json){			if (json.result == 'success') {				   checkFlag=true;			} else {				   showMessageNote("图形验证码有误！")				   checkFlag=false;			}	});		return checkFlag;}//检测手机验证码function checkPhoneAuthCode(){	jQuery.ajaxSetup({async:false});	var checkFlag = false;	var authCode = jQuery.trim( jQuery("#chkPhoneCode").val() );	var mobile_phone = jQuery.trim( jQuery("#mobile_phone").val() );	if(authCode==''){		showMessageNote("请输入手机验证码！")		return false;	}	jQuery.getJSON("/"+base_script+"/ufindpwd/",encodeURI("act=checkMobileAuthcode&mobile="+mobile_phone+"&mobileAuthcode="+authCode+"&type=reg"),function(json){			if (json.rs == 1) {				   checkFlag=true;			} else {				   showMessageNote(json.info);				   checkFlag=false;			}	});		return checkFlag;}//获取验证码function getnewimg(){	var curimg = document.getElementById('authimg');	var randstr=Math.round(Math.random()*10000);	var imgurl="/"+base_script+"/authcode/"+randstr+"/";	curimg.src=imgurl;}//用户名称唯一性检测function checkUsername(){	jQuery.ajaxSetup({async:false});	var username = jQuery.trim(jQuery('#username').val());	var usrFlag = false;	var usernamereg = /^[A-Za-z0-9\u4e00-\u9fa5\_]{1,20}$/; //支持中英文、数字、下划线，限长10个汉字。	if(username==''){		showMessageNote('用户名不能为空。');		return false;	}else if(!usernamereg.test(username)){		showMessageNote('支持中英文、数字、下划线，限长20个字符。');		return false;	}	jQuery.getJSON(encodeURI("/"+base_script+'/ureg/?act=chkname&username='+username),function(json){		if(json.rs==1){			showMessageNote('用户名不可用。');			usrFlag = false;		}else{			usrFlag = true;		}	});	return usrFlag;}//邮箱唯一性检测function checkEmail(){	jQuery.ajaxSetup({async:false});	var mailFlag = false;	var email = jQuery.trim(jQuery('#email').val());	if(email==''){		showMessageNote('邮箱不能为空。');		return false;			}else if(!Utils.isEmail(email)){		showMessageNote('邮箱格式不正确。例如：test@iliangcang.com');		return false;	}		jQuery.getJSON(encodeURI("/"+base_script+'/ureg/?act=chkmail&email='+email),function(json){		if(json.rs==1){			showMessageNote('邮箱不可用。');			mailFlag = false;		}else{			mailFlag = true;		}	});	return mailFlag;}//手机号唯一性检测function checkMobilePhone(){	jQuery.ajaxSetup({async:false});	var mobile_phone = jQuery.trim(jQuery('#mobile_phone').val());	if(mobile_phone==''){		showMessageNote('手机号不能为空。');		return false;	}else if(Utils.isPhone(mobile_phone)==false){		showMessageNote('手机号码格式不正确');		return false;	}	jQuery.getJSON(encodeURI("/"+base_script+'/ureg/?act=chkphone&mobile_phone='+mobile_phone),function(json){		if(json.rs==1){			showMessageNote('该号码已经注册，请直接登录。');			usrFlag = false;		}else{			usrFlag = true;		}	});	return usrFlag;}/**---------------login vilidate------------------- */ function loginCheck(){	jQuery.ajaxSetup({async:false});	var checkFlag  = false;	var username = jQuery.trim(jQuery('#username').val());	var password = jQuery.trim(jQuery('#password').val());	if(username==''){		showMessageNote('请输入您的登录帐户！');		return false;	}	if(password==''){		showMessageNote('请输入您的密码！');		return false;	}		jQuery.post( "/"+base_script+"/login/",{act:'chklogin',username:username,password:password},function(json){		if(json.rs==1){			checkFlag = true;		}else{			showMessageNote('帐号或者密码错误！');			checkFlag = false;		}	},'json');	return checkFlag;}/**---------------get region------------------- */ function getRegion(domid,tagetid){	if(domid=='province'){		jQuery("#city option:first").siblings().remove();		jQuery("#area option:first").siblings().remove();	}else if(domid=='city'){		jQuery("#area option:first").siblings().remove();	}	jQuery.ajaxSetup({async:false});	var parent_id = jQuery("#"+domid+" option:selected").attr('region_id');	if(parent_id==undefined) return;	var curval = jQuery("#"+tagetid).attr('curval');	jQuery.get(encodeURI("/"+base_script+'/userinfo/?act=getregion&parent_id='+parent_id+"&curval="+curval),function(data){		jQuery("#"+tagetid+" option:first").siblings().remove();		jQuery("#"+tagetid+" option:first").after(data);	});}/**---------------edit user emmail and password------------------- */function editUserpwd(){	var curpwd = jQuery.trim(jQuery('#curpwd').val());	var pwd = jQuery.trim(jQuery('#pwd').val());	var repwd = jQuery.trim(jQuery('#repwd').val());	if(curpwd=='') {		showMessageNote("请输入原始密码！");		return false;	}		if(pwd==''){		showMessageNote("请输入新密码！");		return false;	}else if(pwd.length<6||pwd.length>32){		showMessageNote('输入密码需在6位到32位之间。');		return false;	}		if(repwd==''){		showMessageNote("请输入确认密码！");		return false;	}else if(pwd!=repwd){		showMessageNote('密码不一致。');		return false;	}	document.getElementById("theForm").submit();}function checkPwdEmail(){	jQuery.ajaxSetup({async:false});	var user_name = jQuery.trim(jQuery('#user_name').val());	var authcode = jQuery.trim(jQuery('#authcode').val());	if(user_name=='用户名/邮箱/已验证手机'){		showMessageNote('账户名不能为空。');		return false;	}	if(authcode=='请输入验证码'){		showMessageNote('验证码不能为空。');		return false;	}	jQuery.getJSON(encodeURI("/"+base_script+'/ufindpwd/?act=checkname&user_name='+user_name+"&authcode="+authcode),function(data){		if(data.rs == '1'){			window.location.href='/'+base_script+'/ufindpwd/?act=validate&uid='+data.info;		}else{			showMessageNote(data.info);		}	});}function checkModifyPwd(){		var pwd = jQuery.trim(jQuery('#pwd').val());	var repwd = jQuery.trim(jQuery('#repwd').val());	    if(pwd==""){    	alert('请输入密码！');		return false;    }else if(pwd!=''&&pwd.length<6||pwd.length>20){		alert('输入密码需在6位到20位之间。');		return false;	}	    if(repwd==""){    	alert('请输入密码确认！');		return false;    }else if(pwd!=''&&pwd!=repwd){		alert('密码不一致。');		return false;	}	//document.getElementById("theForm").submit();	return true;}/**---------------user address------------------- */function checkUserAdrress(){	var address_name = jQuery.trim(jQuery('#address_name').val());	var country = jQuery.trim(jQuery('#country').val());	var province = jQuery.trim(jQuery('#province').val());	var city = jQuery.trim(jQuery('#city').val());	var area = jQuery.trim(jQuery('#area').val());	var address = jQuery.trim(jQuery('#address').val());	var zipcode = jQuery.trim(jQuery('#zipcode').val());	var mobile = jQuery.trim(jQuery('#mobile').val());	var phone = jQuery.trim(jQuery('#phone').val());	var area_code = jQuery.trim(jQuery('#area_code').val());	var ext_num = jQuery.trim(jQuery('#ext_num').val());		if(address_name==''){		showMessageNote('请输入真实姓名');		return false;	}	if(country==''){		showMessageNote('请选择国家');		return false;	}	if(province==''){		showMessageNote('请选择省份');		return false;	}	if(city==''){		showMessageNote('请选择城市');		return false;	}	/*if(area==''){		showMessageNote('请选择地区');		return false;	}*/	if(address==''){		showMessageNote('请填写详细地址');		return false;	}		if(mobile==''&&phone==''){		showMessageNote('手机号码和电话必须要选填一项');		return false;	}	if(mobile!='' && !/^(13[0-9]|14[0-9]|15[0-9]|18[0-9]|17[0-9])\d{8}$/i.test(jQuery.trim(mobile)))	{		showMessageNote('请填写正确的手机号');		return false;	}		if(phone!=''&&area_code==''){		showMessageNote('请输入电话区号');		return false;	}	document.getElementById('theForm').submit();}/**---------------password strong functions------------------- *///******************************************//CharMode函数//测试某个字符是属于哪一类.//******************************************function CharMode(iN){	if (iN>=48 && iN <=57) //数字	 return 1;	if (iN>=65 && iN <=90) //大写字母	  return 2;	if (iN>=97 && iN <=122) //小写	  return 4;	else	  return 8; //特殊字符} //******************************************//bitTotal函数//计算出当前密码当中一共有多少种模式//****************************************** function bitTotal(num) {	 modes=0;	 for (i=0;i<4;i++)	 {	   if (num & 1) modes++;	   num>>>=1;	 }	 return modes; } //******************************************//返回密码的强度级别//******************************************function checkStrong(sPW){	   if (sPW.length<=5) return 0; //密码太短	   Modes=0;	   for (i=0;i<sPW.length;i++){//测试每一个字符的类别并统计一共有多少种模式.		 Modes|=CharMode(sPW.charCodeAt(i));	   }	   return bitTotal(Modes);}//****************************************** //密码强度显示处理函数 //******************************************  function pwStrength(pwd){	 O_color="content";//默认样式	 L_color="low";//密码级低样式	 M_color="mid";//密码级中的样式	 H_color="high";//密码级强的样式	 var className = O_color;	if (pwd==null||pwd==''){		className = O_color;	}	else{		 S_level=checkStrong(pwd);		 //showMessageNote(S_level)		 switch(S_level) {		 case 1:			 className  = O_color+" "+L_color;			 break;		 case 2:			 className  = O_color+" "+M_color;			 break;		 case 3:			 className =  O_color+" "+H_color;			 break;		default:			className = O_color;		}	}		document.getElementById("pwdStrong").className = className;	return;}    /*---用户图像上传----------------------------*///上传临时图片  function uploadUsrTmpImg()  {  	document.getElementById('headTmpForm').submit();  }  //重置图片选区  function resetImagAreaSelect(){  		 //图片选择区 top:65 left:20          var imgW = $('#imgCutPreview').width();          var imgH = $('#imgCutPreview').height();          var defaultWH = 0; //imgW>=imgH?imgH:imgW;          var _x1 = 0;          var _y1 = 0;          var _x2 = 0;          var _y2 = 0;          if(imgW>=imgH){          	 defaultWH = imgH;               _x1 = (imgW-defaultWH)/2;               _y1 = 0;               _x2 = _x1+defaultWH;               _y2 = _y1+defaultWH;          }else{          	defaultWH = imgW;               _x1 = 0;              _y1 = (imgH-defaultWH)/2;              _x2 = _x1+defaultWH;              _y2 = _y1+defaultWH;          }        $('#f-x1').val(_x1);      	$('#f-y1').val(_y1);      	$('#f-x2').val(_x2);      	$('#f-y2').val(_y2);      	$('#f-w').val(defaultWH);      	$('#f-h').val(defaultWH);      	$('#f-ow').val(imgW);      	$('#f-oh').val(imgH);      	imgAreaObj.setSelection(_x1,_y1,_x2,_y2,true);      	imgAreaObj.setOptions({ show: true });      	imgAreaObj.update();  }//临时图片上传完成    function uploadGoodsImgComplete(){  	var iframeObj = document.getElementById('tmpUpFrame').contentWindow;  	eval("data="+iframeObj.document.body.innerHTML);  	if(data.rs=='true'){  		jQuery("#imgCutPreview").attr('src',data.tmp_img+"?"+Math.random()*100000);  		jQuery("#theOrigImgUrl").val(data.tmp_img);  		  		imgAreaObj=$('#imgCutPreview').imgAreaSelect({  	        handles: true,  	        aspectRatio:'1:1',  	        instance:true,  	        keys:false,  	        minHeight:180,  	        minWidth:180,  	        onSelectEnd: function(img, selection){  	        	$('#f-x1').val(selection.x1);  	        	$('#f-y1').val(selection.y1);  	        	$('#f-x2').val(selection.x2);  	        	$('#f-y2').val(selection.y2);  	        	$('#f-w').val(selection.width);  	        	$('#f-h').val(selection.height);  	        	$('#f-ow').val($(img).width());  	        	$('#f-oh').val($(img).height());  	        }  	    });  		  		window.setTimeout('resetImagAreaSelect()',1500);  	}else{  		showMessageNote(data.errmsg);  	}  	jQuery("#processingBar").hide();  }  //上传切割图片  function headImgUpSubmit()  {	if(jQuery("#theOrigImgUrl").val()==''){		showMessageNote("请选择您要上传的图片！");		return;	}	jQuery("#headImgUpBtn").attr('disabled',true);	jQuery("#userImgLoading").show();  	document.getElementById('headImgUpForm').submit();  }  //上传切割图片完成  function uploadGoodsImgComplete2(){	jQuery("#theOrigImgUrl").val('');	jQuery("#headImgUpBtn").attr('disabled',false);	jQuery("#userImgLoading").hide();  	var iframeObj = document.getElementById('imgUpFrame').contentWindow;  	eval("data="+iframeObj.document.body.innerHTML);  	jQuery(".headImg180").attr('src',data.img_big+"?"+Math.random()*100000);  	jQuery(".headImg50").attr('src',data.img_mid+"?"+Math.random()*100000);  	jQuery(".headImg30").attr('src',data.img_tmb+"?"+Math.random()*100000);  	jQuery("#imgCutPreview").attr('src',static_host+"/images/default/headImgTmp239.png?"+Math.random()*100000);  	imgAreaObj.setOptions({hide:true});  	showMessageNote("您的头像上传完成！");  }  function cancleUpHead(){	 imgAreaObj.setOptions({hide:true});	 jQuery("#headImgUpBtn").attr('disabled',false);	 jQuery("#userImgLoading").hide();	jQuery("#imgCutPreview").attr('src',static_host+"/images/default/headImgTmp239.png?"+Math.random()*100000);}//获取手机短信验证码 by wangjiaming 2015-07-02function getMobileAuthCode(type,obj){	jQuery.ajaxSetup({async:false});	var uid = jQuery.trim(jQuery('#uid').val());	var mobile = jQuery.trim(jQuery('#mobile_phone').val());	if(mobile=='请输入手机号'){		showMessageNote('手机号不能为空。');		return false;	}	if(!/^(13[0-9]|14[0-9]|15[0-9]|18[0-9]|17[0-9])\d{8}$/i.test(jQuery.trim(mobile)))	{		//getnewimg();		jQuery('#authcode').removeAttr('placeholder').val('输入验证码');		jQuery("#authcodeDiv").show();		jQuery("#PhoneCodeDiv").hide();		showMessageNote('请填写正确的手机号');		return false;	}		jQuery.getJSON(encodeURI("/"+base_script+'/ufindpwd/?act=getMobileAuthCode&uid='+uid+'&type='+type +'&mobile='+mobile),function(data){		if(data.rs == '200001'){			time(obj,60);		}else{			if(data.rs == '400005'){				jQuery("#authcodeDiv").hide();				jQuery("#PhoneCodeDiv").show();				time(obj,data.second);			}else{				jQuery('#authcode').removeAttr('placeholder').val('输入验证码');				jQuery("#authcodeDiv").show();				jQuery("#PhoneCodeDiv").hide();			}			showMessageNote(data.info);			//getnewimg();		}	});}//短信发送倒计时function time(o,second) {	var wait = second;	if (wait == 0) {		o.removeAttribute("disabled");		o.value="免费获取验证码";		o.style.background="#ADCCE6";		wait = 60;	} else {		o.setAttribute("disabled", true);		o.value="重新发送(" + wait + ")";		o.style.background="#d4d7d9";		wait--;		setTimeout(function() {			time(o,wait--)		},		1000)	}}